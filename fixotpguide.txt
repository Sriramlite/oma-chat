
âš ï¸ Important Reality (Very important)

Firebase Phone OTP works DIFFERENTLY in:

Web browser ğŸŒ

Android native app ğŸ“±

Capacitor / WebView hybrid âš ï¸

You are currently mixing WEB reCAPTCHA flow with a NATIVE Android app.

âœ… CORRECT FIX (Based on your setup)

You are using:

Capacitor Android

Firebase

Phone OTP

ğŸ‘‰ So you must use Firebase PHONE AUTH FOR ANDROID,
NOT Web reCAPTCHA.

âœ… STEP 1: Do NOT use reCAPTCHA in Android app

In Capacitor Android, Firebase does NOT need visible reCAPTCHA.

Firebase uses:

SafetyNet / Play Integrity

Device verification internally

So this is âŒ WRONG for Android:

new firebase.auth.RecaptchaVerifier(...)

âœ… STEP 2: Detect platform correctly

In your JS:

import { Capacitor } from "@capacitor/core";

const isNative = Capacitor.isNativePlatform();

âœ… STEP 3: Use correct OTP flow
ğŸ”¹ For ANDROID (Capacitor)

Use Firebase Native SDK via plugin
Example (recommended plugin):

@capacitor-firebase/authentication


This avoids reCAPTCHA completely.

ğŸ”¹ For WEB (Browser only)

Use reCAPTCHA:

new RecaptchaVerifier("recaptcha-container", {...})

âœ… STEP 4: Firebase Console fixes (MANDATORY)
1ï¸âƒ£ Enable Phone Auth

Firebase Console â†’
Authentication â†’ Sign-in method â†’ Phone â†’ Enable

2ï¸âƒ£ Add your Android app properly

Firebase Console â†’
Project settings â†’ Your apps â†’ Android

Make sure:

Package name matches Capacitor app ID

google-services.json is added

App is registered

3ï¸âƒ£ SHA-1 & SHA-256 added

Firebase Console â†’
Project settings â†’ Android app â†’ Add SHA-1 & SHA-256

Get them using:

cd android
./gradlew signingReport


âš ï¸ Missing SHA keys = OTP FAILS silently or throws this error

âœ… STEP 5: For testing (VERY IMPORTANT)

Add test numbers to avoid OTP limits:

Firebase Console â†’
Authentication â†’ Sign-in method â†’ Phone â†’ Test phone numbers

Example:

+916381798212 â†’ 123456


This bypasses reCAPTCHA completely.

ğŸ§  Why it shows (Origin: https://localhost)

Because:

Capacitor WebView runs as localhost

Firebase thinks itâ€™s a web app

reCAPTCHA fails â†’ invalid token

This is expected behavior if wrong flow is used.

ğŸ† Correct Architecture for OMA / Antigravity
Platform	OTP Method
Android (Capacitor)	âœ… Firebase Native Phone Auth
Web browser	âœ… Firebase Web + reCAPTCHA
Desktop Chrome	âœ… Firebase Web + reCAPTCHA

ğŸ‘‰ Do NOT reuse the same OTP logic everywhere